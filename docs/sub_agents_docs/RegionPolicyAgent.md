# Region Policy Agent Reference

## PARKING_REGION_POLICY.md (docs/planning/PARKING_REGION_POLICY.md)

이 문서는 지역 기반 주차 정보 표시(v1.2)에 대한 정책을 정의합니다.

- **핵심**: 서비스는 전국 제공, 주차 정보는 `CORE_REGION`에서만 상세 노출
- **지역 상태**: `OPEN` → `CANDIDATE` → `CORE` (단, 조건 충족 시 `CANDIDATE` 단계를 내부적으로 거쳐 `CORE`로 자동 승격될 수 있음)
- **정보 노출**:
    - `OPEN_REGION`, `CANDIDATE_REGION`: 정보 미노출, 데이터 수집만 가능
    - `CORE_REGION`: 뱃지, 성공률, 통계 노출
- **안내 문구**: 지정된 고정 문구 사용 (변형 불가)
- **API 안전성**: 비노출 지역의 통계 데이터는 API 레벨에서 완전히 제거하며, 응답에 포함하거나 null 처리하지 않는다.

---

## PARKING_REGION_SEARCH_BULK.md (docs/planning/PARKING_REGION_SEARCH_BULK.md)

이 문서는 전국 검색 및 Bulk Info API를 통한 주차 정보 표시 정책을 정의합니다.

- **검색**: 전국 범위 검색 가능, `CORE_REGION` 여부와 관계없이 검색 결과 노출.
- **Bulk Info API**: 여러 장소의 주차 정보와 지역 상태를 한 번에 조회.
    - `CORE_REGION`: `parkingInfo` (뱃지, 성공률) 포함.
    - `Non-CORE`: `parkingInfo` 필드 제거 (`null`).
- **마커 표시**:
    - 기본: 전국 마커 표시.
    - `CORE_REGION` 필터: 주차 정보가 있는 지역만 필터링.
    - 빈 상태: "주차 정보가 공개된 지역이 없어요" 안내.

---

## AI 작업 지침

이 문서를 참조하는 AI 에이전트는 다음 지침을 준수해야 합니다.

### 1. 코드 구현 시
- **지역 상태 확인 로직 필수**: 주차 정보를 표시하는 모든 UI/로직에서 현재 지역의 상태(`OPEN`, `CANDIDATE`, `CORE`)를 확인해야 합니다.
- **분기 처리**:
  - `CORE_REGION`일 때만 주차 뱃지, 성공률, 상세 통계를 렌더링합니다.
  - 그 외 지역에서는 "데이터 수집 중" 또는 "검토 중" 상태를 표시하거나, 관련 UI를 숨깁니다.
- **데이터 수집은 항상 허용**: 지역 상태와 관계없이 사용자의 "주차 경험 기록" 기능은 항상 활성화되어야 합니다.
- **Bulk Info API**: `POST /api/places/bulk-info` 구현 시 `places` 목록의 각 장소에 대해 지역 상태를 판별하고, `Non-CORE`인 경우 `parkingInfo` 필드를 응답 객체에서 아예 제거해야 합니다.

### 2. UI/UX 설계 시
- **부정적 경험 최소화**: 정보 미노출이 "서비스 불가"가 아닌 "데이터 부족"으로 인식되도록 안내 문구를 배치합니다.
- **공통 문구 사용**: "주차 정보는 실제 방문 기록을 기반으로 제공되며..." 문구를 적절한 위치에 노출합니다.
- **Map & Filter**:
  - **초기 위치**: 유저 위치(Geolocation) 최우선.
  - **검색 & 마커**: 전국 검색 지원, 마커는 전국 표시.
  - **필터 제거**: 지역 한정 필터 버튼은 삭제됨. 지도 이동 시 자동으로 정보 노출.
  - **클라이언트 판별**: API 응답 전이라도 주소 기반(예: 대구, 경산)으로 `CORE` 여부를 판별하여 UI를 즉시 업데이트하도록 구현 권장.

### 3. 데이터/서버 로직
- **자동 승격 (백그라운드)**:
  1일 1회 트래픽이 적은 시간에 실행되는 백그라운드 작업으로,
  사전에 정의된 모든 정량 승격 조건을 확인하고
  해당 조건을 모두 만족한 경우에만 `CORE_REGION`으로 상태를 변경한다.
- 자동 승격만 존재하며 자동 강등 로직은 존재하지 않는다.
- `CORE_REGION`은 명시적 정책 변경 없이는 유지된다.
- **API Guard (필수)**: `OPEN`, `CANDIDATE` 지역 요청 시 `successRate`, `stats`, `badges` 등의 필드는 반드시 API 응답에서 완전히 제외합니다. (null 사용 금지) 클라이언트 숨김 처리에 의존 금지.
- **AI 판단 금지**: 승격 로직에 ML 모델, 확률, 외부 트래픽 점수를 절대 사용하지 않습니다. 오직 DB 데이터 카운트만 사용.
- **Promotion Audit Log**: 자동 승격 발생 시 `regionId`, `승격 시점`, `충족된 조건 값`을 반드시 로그로 남겨야 합니다.

### Region State Consistency (권장)
- 동일 API 요청 처리 중에는 지역 상태를 재계산하지 않는다.
- 지역 상태 변경은 집계 배치 작업 완료 이후에만 반영된다.

### 4. QA 및 테스트
- **API 응답 검증**: `curl` 등을 통해 `OPEN_REGION` 조회 시 통계 데이터가 내려오지 않는지 확인합니다.
- **문구 검증**: UI에 노출되는 안내 문구가 고정 정책을 정확히 따르는지 텍스트 일치 여부를 확인합니다.
- **지역 변경 테스트**: `CORE` -> `OPEN` 등 지역 상태 변경 시 UI가 즉시 반영되는지 확인합니다.
- **문구 검증**: 특정 지역명(예: 대구)이 하드코딩된 에러 메시지가 없는지 확인합니다.

