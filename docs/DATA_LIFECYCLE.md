# 데이터 수명 및 TTL 정책

## 목적
- 주차 데이터 수집과 분석을 최우선
- DB 용량과 성능 관리
- 데이터 신뢰도와 집계 정확성 유지

---

## 컬렉션별 수명 정책

| 컬렉션 | 보관 기간 | TTL | 아카이빙 |
|--------|----------|-----|----------|
| VoteRoom | 영구 | ❌ | 3년 단위 |
| Vote | 영구 | ❌ | 3년 단위 |
| ParkingData | 1년 | ✅ 31536000초 | 자동 삭제 |
| ParkingStats | 영구 | ❌ | ❌ |
| Client Storage | 14일 | ✅ (앱 진입 시) | 자동 삭제 |

---

## 클라이언트 데이터 (LocalStorage)

### 저장 항목
- `babmoa_participant_id`: 브라우저 식별용 UUID (영구)
- `voted_{roomId}`: 투표 참여 여부 (14일 후 만료)
- `parking_{roomId}`: 주차 정보 기록 여부 (14일 후 만료)

### 만료 정책
- **기간:** 14일 (2주)
- **방식:** 앱 진입 시(`StorageCleaner`) 만료된 항목 자동 삭제
- **목적:** 브라우저 저장소 용량 관리 및 개인정보 보호

---

## VoteRoom (투표방)

**보관 기간**: 영구

**TTL**: 없음

**이유**:
- 투표방 기록 참조 및 분석
- 기존 방 링크 재사용 가능
- B2B 데이터 연계 분석 필요

**장기 관리**:
- 3년 이상 데이터는 별도 아카이빙 (백업 DB/S3 등)
- 쿼리에서 오래된 데이터 제외 가능

---

## Vote (투표 기록)

**보관 기간**: 영구

**TTL**: 없음

**이유**:
- 집계 및 통계 기반 신뢰도 확보
- 악성/중복 투표 탐지, 검증 목적

**장기 관리**:
- 3년 이상 데이터 아카이빙 가능
- 필요 시 수동/자동 삭제 정책 적용 가능

---

## ParkingData (주차 경험)

**보관 기간**: 1년

**TTL**: 31536000초 (1년)

**이유**:
- B2B 제공용, 오래된 데이터 자동 삭제
- 개인정보 및 비용 관리

**삭제**: MongoDB TTL 인덱스로 자동 삭제

```javascript
// 구현 (ParkingData.js)
createdAt: {
    type: Date,
    default: Date.now,
    expires: 31536000  // TTL: 1년
}
```

---

## ParkingStats (집계 데이터)

**보관 기간**: 영구

**TTL**: 없음

**이유**:
- 집계본/B2B 제공용 데이터 유지
- 서버 캐시 및 클라이언트 조회 가능

---

## 관리 및 운영 정책

### DB 성능
- **인덱스**: `_id`, `roomId`, `participantId`, `createdAt` 등
- 오래된 문서는 쿼리 조건에서 제외 가능
- 샤딩/파티셔닝으로 대규모 데이터 관리 가능

### 아카이빙
- **주기**: 3년 단위
- **방법**: 백업 DB 또는 S3 저장
- 아카이빙 후 원본 삭제 가능

### 삭제 정책
- TTL 없는 컬렉션은 자동 삭제하지 않음
- 필요 시 관리자가 수동/자동 삭제 가능

---

## 데이터 흐름

```
VoteRoom 생성 (영구)
    ↓
Vote 저장 (영구)
    ↓
ParkingData 기록 (1년 TTL)
    ↓
ParkingStats 업데이트 (영구)
```

---

## 결론

| 데이터 | 정책 |
|--------|------|
| VoteRoom, Vote | 영구 보관, 3년 단위 아카이빙 |
| ParkingData | TTL 1년 적용, 자동 삭제 |
| ParkingStats | 영구 보관 |

> DB 성능/용량 관리와 데이터 신뢰도를 동시에 고려
