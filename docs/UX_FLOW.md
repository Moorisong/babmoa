# 사용자 플로우 (UX Flow)

## 전체 흐름도

```
투표 생성 → 팀원 공유(링크) → 투표 참여 → 투표 마감 → 결과 확인 → 주차 경험 기록 → 서버 저장
```

---

## 1. 투표 생성 (지도 기반)

**누가**: 회식 주최자  
**무엇을**: 투표방 생성  

**화면 구성**:
- 🗺️ **지도 중심 UI**: 카카오맵 지도가 메인
- 📍 **지역 필터**: 관악구 / 영등포구 / 강남구 선택
- 🏷️ **마커 클릭 시**: Bottom Sheet (상세 정보 + 주차 뱃지)
- 🔍 **검색 버튼**: "이미 정해졌다면 검색으로 추가" (보조 수단)

**입력**: 
- 제목 (예: "12월 송년회 장소")
- 후보 장소 선택 (지도 마커 클릭 → Bottom Sheet에서 추가 / 검색 모달에서 추가)
- 마감 시간 설정

**출력**: 공유 가능한 투표 링크

> 📖 상세: [MAP_INTEGRATION.md](./MAP_INTEGRATION.md)

---

## 2. 투표 공유

**방식**:
- 링크 복사
- 카카오톡 공유

**특징**:
- 로그인 없이 참여 가능
- 투표 1개 = URL 1개

---

## 3. 투표 참여

**규칙**:
- 단일 선택 (1인 1표)
- "상관없음 / 패스" 옵션 제공
- 시간 제한 투표

**1인 1표 제한 로직**:
1. 클라이언트: `participantId` (UUID)를 LocalStorage에서 조회/생성
2. 투표 요청 시 `participantId`를 서버에 전송
3. 서버: `roomId + participantId` 조합으로 중복 체크 (Unique Index)
4. 이미 투표했으면 **upsert로 기존 투표 수정** (투표 변경 허용)
5. 클라이언트: `voted_{roomId}` 로컬 캐시로 UI 상태 관리

**한계 (MVP 허용)**:
- 브라우저/디바이스를 바꾸면 중복 투표 가능
- 완벽한 1인 1표보다 **자연스러운 데이터 수집**이 우선

---

## 4. 결과 확인

**마감 후 표시**:
- 확정 장소
- 득표 현황

**동점 처리**:
- 랜덤 또는 주최자 결정

---

## 5. 주차 경험 기록

**타이밍**: 결과 페이지 재진입 시 (방문 후)

**질문 흐름**:
```
Q1. 주차장 있었나요?
├─ 있었음 → Q2로
├─ 없었음 → 기록 완료 (주차장 없음으로 저장)
└─ 잘 모르겠어요 → unknown 처리

Q2. 주차 어떠셨어요?
├─ 문제없었어요
├─ 조금 불편했어요
├─ 못 했어요
└─ 잘 모르겠어요
```

**특징**:
- 단일 클릭으로 완료
- 강요하지 않음 (자연스러운 유도)

---

## 페이지 구성

| 경로 | 설명 |
|------|------|
| `/` | 메인 (투표방 생성) |
| `/room/[id]` | 투표 참여 |
| `/room/[id]/result` | 투표 결과 |
| `/room/[id]/parking` | 주차 경험 기록 |

---

## 6. 자동 마감

**마감 방식**: 설정된 `deadline` 시간 도달 시 자동 마감

**마감 후 동작**:
| 기능 | 동작 |
|------|------|
| 추가 투표 | ❌ 불가 |
| 결과 확인 | ✅ 가능 |
| 주차 경험 기록 | ✅ 가능 (데이터 수집 유지) |

**마감 전 동작**:
| 기능 | 동작 |
|------|------|
| 투표 | ✅ 가능 |
| 결과 미리보기 | ✅ 가능 (명세 변경) |
| 주차 경험 기록 | ✅ 가능 |

**특징**:
- 방장 식별/수동 종료 버튼 없음
- 서버에서 API 호출 시 자동으로 `isClosed` 체크
- 데이터 수집 루프 유지가 최우선
